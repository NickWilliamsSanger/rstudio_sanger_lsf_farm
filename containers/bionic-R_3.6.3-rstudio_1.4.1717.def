Bootstrap: debootstrap
OSVersion: bionic
MirrorURL: http://archive.ubuntu.com/ubuntu
Include: ca-certificates curl software-properties-common gnupg

%post
  export DEBIAN_FRONTEND=noninteractive

  printf "%s\n" >/etc/apt/sources.list \
    "deb http://archive.ubuntu.com/ubuntu bionic main universe" \
    "deb https://cloud.r-project.org/bin/linux/ubuntu bionic-cran35/"

  apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
  apt update

  curl -o /rstudio.deb https://download2.rstudio.org/server/bionic/amd64/rstudio-server-1.4.1717-amd64.deb
  apt install -y r-base /rstudio.deb

  rm /rstudio.deb
  apt autoremove
  apt clean

  cat >/etc/rstudio/database.conf <<-EOF
	provider=sqlite
	directory=/var/lib/rstudio-server
	EOF

  unset DEBIAN_FRONTEND
